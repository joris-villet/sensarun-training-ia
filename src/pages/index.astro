---
import Layout from "../layouts/Layout.astro";
import InputPrompt from "../components/InputPrompt.svelte";
import ContainerMessages from "../components/ContainerMessages.svelte";
import Logout from "../components/astro/Logout.astro";
// import MaxTokens from '../components/MaxTokens.svelte'
import CurrentUser from "../components/CurrentUser.svelte";
import HydrateUser from "../components/HydrateUser.svelte";
import { Image } from 'astro:assets';

// const cookie = Astro.cookies?.get('session')?.value!
// console.log('page index => ', JSON.parse(cookie))

// storeUser.name = JSON.parse(cookie).name;
// const firstname = JSON.parse(cookie).name;
// Define the type for Astro.locals to include 'user'
const bgWoman = '/img/bg-sensarun-woman.jpg';

interface Locals {
  user: {
    name: string;
    picture: string;
  };
}

// Cast Astro.locals to the defined type
const { user } = Astro.locals as Locals;
---

<Layout>

	<main>
    <div class="relative h-screen overflow-hidden">
      <img class="absolute top-0 left-0 w-full h-full" src={bgWoman} alt="background woman is running">
      <!-- <Image src={bgWoman} alt="woman" width="100" height="100"/> -->
      <HydrateUser picture={user.picture} client:only="svelte" />
  
      <!-- Sidebar desktop -->
      <div class="hidden md:block w-64 fixed h-[calc(100vh-3rem)] z-20 mt-12 border border-neutral-200 rounded-tr-2xl overflow-hidden">
        <div class="bg-lime-100 h-full pb-6 flex flex-col justify-between">
          <CurrentUser name={user.name} client:only="svelte" />
          <Logout />
        </div>
      </div>
      
  
      <!-- Navigation mobile en haut -->
      <div class="sm:hidden fixed top-0 left-0 right-0 z-20 bg-neutral-50 border-b border-neutral-200 p-4">
        <div class="flex justify-between items-center">
          <CurrentUser name={user.name} client:only="svelte" />
          <Logout />
        </div>
      </div>
  
      <!-- Contenu principal -->
      <div class="md:ml-64 flex flex-col h-full overflow-hidden relative pb-16 md:pb-0">
        <div class="flex-1 overflow-y-auto pb-24">
          <ContainerMessages client:only="svelte" />
        </div>
  
        <div class="absolute bottom-0 left-0 right-0 z-10">
          <InputPrompt client:only="svelte" />
        </div>
      </div>
    </div>
  </main>


</Layout>

<style>
  .bg-gradient {
    background: #c9ffc2;
    background: linear-gradient(
      90deg,
      rgba(201, 255, 194, 1) 1%,
      rgba(255, 253, 191, 1) 100%
    );
  }
</style>
